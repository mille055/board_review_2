:root{
  --bg:#121316; --panel:#1a1b1f; --muted:#2a2c33; --text:#e6e6e9; --text-dim:#a9acb3;
  --accent:#6ea8fe; --accent-2:#8a9dfc; --ok:#4ade80; --warn:#fbbf24; --bad:#f87171;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
}
.app{display:grid; grid-template-columns: 300px 1fr; height:100vh}
.sidebar{background:var(--panel); border-right:1px solid var(--muted); padding:18px; overflow:auto;}
.brand{display:flex; align-items:center; gap:10px; margin-bottom:14px}
.brand .dot{width:10px; height:10px; border-radius:50%; background:linear-gradient(135deg,var(--accent),var(--accent-2)); box-shadow:0 0 16px var(--accent)}
h1{font-size:16px; margin:0}
.section{margin-top:18px}
.label{font-size:12px; color:var(--text-dim); letter-spacing:.06em; text-transform:uppercase; margin-bottom:8px}
.chips{display:flex; flex-wrap:wrap; gap:6px}
.chip{
  background:#0f1013; border:1px solid var(--muted); color:var(--text-dim);
  padding:6px 10px; border-radius:999px; cursor:pointer; user-select:none; transition:.15s;
}
.chip.active{border-color:var(--accent); color:var(--text); box-shadow:0 0 0 1px rgb(110 168 254 / .2) inset}
.search{display:flex; gap:8px}
.search input{
  flex:1; background:#0f1013; color:var(--text); border:1px solid var(--muted);
  border-radius:10px; padding:10px 12px; outline:none;
}
.btn{
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  color:#0b0c10; border:none; border-radius:10px; padding:10px 12px; cursor:pointer; font-weight:600;
}
.btn.ghost{background:transparent; color:var(--text); border:1px solid var(--muted);}
.content{display:grid; grid-template-rows: auto 1fr; height:100%; overflow:hidden}
.toolbar{
  padding:14px 16px; border-bottom:1px solid var(--muted); background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);
  display:flex; align-items:center; gap:10px; justify-content:space-between;
}
.counts{color:var(--text-dim); font-size:14px}
.grid{padding:14px; overflow:auto; display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:12px}
.card{background:var(--panel); border:1px solid var(--muted); border-radius:14px; padding:12px; display:flex; flex-direction:column; gap:10px}
.thumb{aspect-ratio: 4/3; background:#0f1013; border-radius:10px; display:flex; align-items:center; justify-content:center; overflow:hidden; border:1px solid #22242a}
.thumb img{width:100%; height:100%; object-fit:cover}
.meta{display:flex; align-items:center; justify-content:space-between; color:var(--text-dim); font-size:12px}
.viewer{position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:stretch; justify-content:center; z-index:50;}
.viewer.show{display:flex}
.viewer-inner{display:grid; grid-template-columns: 360px 1fr; gap:0; width:100%; max-width:1400px; margin:auto; height:92vh; border-radius:18px; overflow:hidden; border:1px solid #2a2c33}
.viewer-sidebar{background:var(--panel); padding:16px; border-right:1px solid var(--muted); overflow:auto}
.viewer-stage{position:relative; background:#000;}
.viewer-toolbar{position:absolute; left:12px; right:12px; top:12px; display:flex; gap:8px; align-items:center; justify-content:space-between; z-index:2;}
.viewer-controls{background:rgba(20,22,26,.6); backdrop-filter: blur(6px); border:1px solid var(--muted); border-radius:12px; padding:10px; display:flex; gap:10px; align-items:center}
.input{display:flex; align-items:center; gap:6px; color:var(--text-dim); font-size:12px}
.input input[type="range"]{width:140px}
canvas{position:absolute; inset:0; width:100%; height:100%}
.viewer-thumbs{display:grid; grid-template-columns: repeat(3,1fr); gap:8px}
.viewer-thumbs img{width:100%; aspect-ratio: 1; object-fit:cover; border-radius:8px; border:1px solid #2a2c33; cursor:pointer; opacity:.85; transition:.12s;}
.viewer-thumbs img.active, .viewer-thumbs img:hover{opacity:1; border-color:var(--accent)}
.pill{font-size:11px; padding:3px 8px; border-radius:999px; border:1px solid var(--muted); color:var(--text-dim)}
.kbd{border:1px solid var(--muted); border-bottom-width:2px; border-radius:6px; padding:2px 6px; font-size:12px; color:var(--text-dim)}
.sr{position:absolute; left:-10000px}
.small{font-size:12px;color:var(--text-dim)}
.mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}
.box{background:#0f1013;border:1px solid #2a2c33;border-radius:8px;padding:8px}
.score{display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center}
.mcq-card{padding:12px;border:1px solid #333;border-radius:8px;margin-bottom:12px}
.mcq-stem{margin-bottom:8px;font-weight:600}
.mcq-choice{display:flex;gap:.5rem;align-items:flex-start;padding:6px;border-radius:6px}
.mcq-choice.mcq-correct{background:#103d22}
.mcq-choice.mcq-wrong{background:#3d1010}
.mcq-choice.mcq-missed{outline:1px dashed #2aa}
.mcq-actions{display:flex;gap:8px;margin-top:8px}
.mcq-explain.hidden{display:none}
.mcq-expl-title{font-weight:600;margin:6px 0}
.mcq-score{margin-top:8px;font-weight:600}
.chat-modal{z-index: 3000}
.chat-backdrop{z-index: 2990}

#llmChatLog { white-space: normal; line-height: 1.4; }
.chat-user, .chat-assistant { margin: 6px 0; }

/* --- LLM Chat Modal (sits above .viewer) --- */
.modal{
  position: fixed;
  inset: 0;
  display: none;               /* toggled via .show */
  align-items: center;
  justify-content: center;
  z-index: 5000;               /* > .viewer z-index (50) */
}
.modal.show{ display: flex; }

.modal .modal-backdrop{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,.6);
}

.modal .modal-inner{
  position: relative;
  background: var(--panel);
  border: 1px solid var(--muted);
  border-radius: 12px;
  width: min(900px, 95vw);
  max-height: 85vh;
  padding: 14px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 1;
}

.modal .modal-inner textarea,
.modal .modal-inner [contenteditable="true"]{
  background: #0b0d12;           /* dark */
  color: var(--text);            /* uses your light text color */
  border: 1px solid var(--muted);
  border-radius: 10px;
  width: 100%;
  min-height: 50vh;              /* taller so you can see everything */
  padding: 12px 14px;
  line-height: 1.45;
  font-size: 15px;
  resize: vertical;              /* allow manual resize if you want */
  outline: none;
}

/* Chat log: allow rendered HTML to flow normally */
#llmChatLog{
  white-space: normal;        /* markdown renders as HTML */
  line-height: 1.4;
}
.chat-user{ margin: 6px 0; }
.chat-assistant{ margin: 6px 0; }
